version: "3"
services:
  galaxy-server:
    environment:
      - GALAXY_DEFAULT_ADMIN_USER=admin
      - GALAXY_DEFAULT_ADMIN_EMAIL=admin@galaxy.org
      - GALAXY_DEFAULT_ADMIN_PASSWORD=password
      - GALAXY_DEFAULT_ADMIN_KEY=fakekey
  galaxy-configurator:
    environment:
      - GALAXY_CONFIG_CLEANUP_JOB=never
      - NGINX_UWSGI_READ_TIMEOUT=3600
      - DONT_EXIT=true
  # Terminates the container after $TIMEOUT minutes
  # which results in the whole setup terminating if --exit-code-from
  # is set (see CI)
  timeout:
    image: alpine:3.11
    environment:
      - TIMEOUT=${TIMEOUT:-120}
    command: sh -c "echo \"Setting timeout to $$TIMEOUT minutes\" && sleep $$((( $$TIMEOUT * 60 ))) && echo \"Timeout after $$TIMEOUT minutes!\" && exit 1"
